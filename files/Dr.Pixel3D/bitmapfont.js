var test_font_data_type_1 = {
	font_src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjoAAAANCAYAAACgqMT8AAAFoElEQVR4Xu1c0bLVQAjT//9o9TizynATErrbnusVn7RlKYQQaM+M37/Nn0FgEBgEBoFBYBAYBL4oAt+/aF6T1iAwCAwCg8AgMAgMAt/cRefHL6yi7evfrz+va/Hvr2vLNp+J9xzos991hl2PPqsYVIxObKdsEEanfI8fjMDiz+Jv5pVzPfrYsc9+ck/FDFb/ofhRf1b2qweW/2ib+3z1ONIK9txuPKfwrPLKbEB5Md244zqKh3GR6QTjcvTjanxHn3d1q3PesXVsHD1UftR95xlj4yGA5ny1h5Re3SY4sehUYpaDjM/rJleJLFqGPNjPW7G88uBkAnRlYGdxZ4O2OzCYfXX9PKLaY3cwP22vBlQ3nqv+MufUoM0vPFmk7lgUnIVMaUEXz1P2ld5V/c70GtWHYV51iTvIXTv2LPf8KbuKv4hHu3FrJXqPhYvne6L7+1S3Xkrf/njcWXTQWyAbnN2mU/a7QLAl4ckCq2Uuv5FXDakGSRTP6rmMOArv7gB4Eudquc24ZV5081I4ZXxde9XQ3YGu6qz8sTwQnnG53sVT8VwJucqr6x/1kptjVVOUR5WbyrvTb44vx+bJhWo3HtVf7v0Ozu+wPYXT3bGf0sXtRcchMWr4dY4NcWcIO89Wb0zsrekpQleCu4ats9ioeJFwOxg7DVH5cQbGK/a8aKPcnVoiTqgccvwrnhjD+nv0H79eID53f+LJvhc32XXUOyxOlx/RjtWlyostODEX9VORyjf2bM4X/azu5OEuJYrPXZyfsj8xkCLW6OfQjDOyV5zOfZTtVX0dPjhaE+vs8ifqRn75Z1rO5qDCIcZUcVL56f5Urfh/pY8yN6sXe6dfEA//1PzqF52qgRgoWajQ525EFCSQ7PnuJljFGOM8IRTIhyJGtQhlfyjn3GBsKWECUQkHI11H4NhCoxadKldHmFTsFScRf7O/u/mneFPl113AnE/6bMHpxnkFN1Rv1Ruqr1xBR3aO7qn4HEF36nhKt3br6OLp8rYbTxfPSjfRXKj47y4l6gWA9SFboqqZfor/CNeqJ6o6ME3v8Fzx4oe76LiNkwck27JcwLtLhyuY1aLENk22sHTsWT6sYbqNyoSULTqOfdXgrkCpPBx+sdqqs865iP/yd0WAXP5VQ7HivGro3Xownuzm1R14bIFUfaIWiSu6gzBRcajnKF2rONsZDKo31P0u367wJMaAvro4X7YV3p241sxycK4WHRT3Lp6OjscZfBrPXd6rOqk54dYxcur3mdOLTmzgXBRG6Dxk8oBxBtWHxMKF7nk22FcDKHFY55k9a6Bo7xDCyStjW4kKq90di85qRudzclXbiDXC28Goyu+UMLl+uo2ehcdddLrnXIFRfndwYCJfib/qo+o+yqU72Nx6qAXN6YE7tTxrWu7fTt3jWdWfqj5sKVF1V3Wp9KlaYDo4ZL1F+o9mKPvZCc0lhYPjH/WX0xtZVxlnnLi7uvjBp9scipCoEdEZl7iosdxYq4HtLCl3LjrdgaEaUgmkqoE7eDoN4yxMlZCwBVGRXWHhDItl4/yGHf1l8UN+kP3CId+r+i2eUXHGPsq4Km4gIVZxKqFn8Tj5xhcgR0cQj1jOuV4V1yqRd/uV1T2eZzGxurj6iPhT6SJaTCIGiFcoduSn4ifS4Wjv8oH5YTqvfrJFgz/XvctPB0/3A4CqL4pt1VDpPNN2J99cr8w556W3ir3isP3/6JRO/pObnWXvCiSMoGywMaJcJborWEqAOn4QTnfjfKU2c2YQGASeR0BpgbqvIt49r/y79904XDv3uU/bvS1+9y3gaUA+2/PeVqDPBsTN8QzONwM87geBfwgB9YVhVy92z5+C0o3DtTsV164fVb9d//b5WXRsqMZwEBgEBoFB4CEE2FBXX6zd8D7T0uDG4tq5GDxhd6peW7H+BJpngDoKyzbXAAAAAElFTkSuQmCC',
	font_map: ' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~',
	font_width: 6,
	font_height: 13,
	font_per_row: -1,
};


var test_font_data_type_2 = {
	font_src: 'BeanFont.png',
	font_map: ' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~',
	font_size: [
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], 
		[6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], [6, 13], //97 total
	],
	font_per_row: -1,
};

//var res = ""; for (var i = 0; i < 97; i++) { res += '[' + i * 6 + ', 0, 6, 13],\n'; }
var test_font_data_type_3 = {
	font_src: 'BeanFont.png',
	font_map: ' !"#$%&\'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~',
	font_offset_rect: [
		[0, 0, 6, 13],
		[6, 0, 6, 13],
		[12, 0, 6, 13],
		[18, 0, 6, 13],
		[24, 0, 6, 13],
		[30, 0, 6, 13],
		[36, 0, 6, 13],
		[42, 0, 6, 13],
		[48, 0, 6, 13],
		[54, 0, 6, 13],
		[60, 0, 6, 13],
		[66, 0, 6, 13],
		[72, 0, 6, 13],
		[78, 0, 6, 13],
		[84, 0, 6, 13],
		[90, 0, 6, 13],
		[96, 0, 6, 13],
		[102, 0, 6, 13],
		[108, 0, 6, 13],
		[114, 0, 6, 13],
		[120, 0, 6, 13],
		[126, 0, 6, 13],
		[132, 0, 6, 13],
		[138, 0, 6, 13],
		[144, 0, 6, 13],
		[150, 0, 6, 13],
		[156, 0, 6, 13],
		[162, 0, 6, 13],
		[168, 0, 6, 13],
		[174, 0, 6, 13],
		[180, 0, 6, 13],
		[186, 0, 6, 13],
		[192, 0, 6, 13],
		[198, 0, 6, 13],
		[204, 0, 6, 13],
		[210, 0, 6, 13],
		[216, 0, 6, 13],
		[222, 0, 6, 13],
		[228, 0, 6, 13],
		[234, 0, 6, 13],
		[240, 0, 6, 13],
		[246, 0, 6, 13],
		[252, 0, 6, 13],
		[258, 0, 6, 13],
		[264, 0, 6, 13],
		[270, 0, 6, 13],
		[276, 0, 6, 13],
		[282, 0, 6, 13],
		[288, 0, 6, 13],
		[294, 0, 6, 13],
		[300, 0, 6, 13],
		[306, 0, 6, 13],
		[312, 0, 6, 13],
		[318, 0, 6, 13],
		[324, 0, 6, 13],
		[330, 0, 6, 13],
		[336, 0, 6, 13],
		[342, 0, 6, 13],
		[348, 0, 6, 13],
		[354, 0, 6, 13],
		[360, 0, 6, 13],
		[366, 0, 6, 13],
		[372, 0, 6, 13],
		[378, 0, 6, 13],
		[384, 0, 6, 13],
		[390, 0, 6, 13],
		[396, 0, 6, 13],
		[402, 0, 6, 13],
		[408, 0, 6, 13],
		[414, 0, 6, 13],
		[420, 0, 6, 13],
		[426, 0, 6, 13],
		[432, 0, 6, 13],
		[438, 0, 6, 13],
		[444, 0, 6, 13],
		[450, 0, 6, 13],
		[456, 0, 6, 13],
		[462, 0, 6, 13],
		[468, 0, 6, 13],
		[474, 0, 6, 13],
		[480, 0, 6, 13],
		[486, 0, 6, 13],
		[492, 0, 6, 13],
		[498, 0, 6, 13],
		[504, 0, 6, 13],
		[510, 0, 6, 13],
		[516, 0, 6, 13],
		[522, 0, 6, 13],
		[528, 0, 6, 13],
		[534, 0, 6, 13],
		[540, 0, 6, 13],
		[546, 0, 6, 13],
		[552, 0, 6, 13],
		[558, 0, 6, 13],
		[564, 0, 6, 13],
		[570, 0, 6, 13],
		[576, 0, 6, 13], //97 total
	],
};





//image_element.src = 'images/BeanFont.png';
//image_element.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjoAAAANCAYAAACgqMT8AAAFoElEQVR4Xu1c0bLVQAjT//9o9TizynATErrbnusVn7RlKYQQaM+M37/Nn0FgEBgEBoFBYBAYBL4oAt+/aF6T1iAwCAwCg8AgMAgMAt/cRefHL6yi7evfrz+va/Hvr2vLNp+J9xzos991hl2PPqsYVIxObKdsEEanfI8fjMDiz+Jv5pVzPfrYsc9+ck/FDFb/ofhRf1b2qweW/2ib+3z1ONIK9txuPKfwrPLKbEB5Md244zqKh3GR6QTjcvTjanxHn3d1q3PesXVsHD1UftR95xlj4yGA5ny1h5Re3SY4sehUYpaDjM/rJleJLFqGPNjPW7G88uBkAnRlYGdxZ4O2OzCYfXX9PKLaY3cwP22vBlQ3nqv+MufUoM0vPFmk7lgUnIVMaUEXz1P2ld5V/c70GtWHYV51iTvIXTv2LPf8KbuKv4hHu3FrJXqPhYvne6L7+1S3Xkrf/njcWXTQWyAbnN2mU/a7QLAl4ckCq2Uuv5FXDakGSRTP6rmMOArv7gB4Eudquc24ZV5081I4ZXxde9XQ3YGu6qz8sTwQnnG53sVT8VwJucqr6x/1kptjVVOUR5WbyrvTb44vx+bJhWo3HtVf7v0Ozu+wPYXT3bGf0sXtRcchMWr4dY4NcWcIO89Wb0zsrekpQleCu4ats9ioeJFwOxg7DVH5cQbGK/a8aKPcnVoiTqgccvwrnhjD+nv0H79eID53f+LJvhc32XXUOyxOlx/RjtWlyostODEX9VORyjf2bM4X/azu5OEuJYrPXZyfsj8xkCLW6OfQjDOyV5zOfZTtVX0dPjhaE+vs8ifqRn75Z1rO5qDCIcZUcVL56f5Urfh/pY8yN6sXe6dfEA//1PzqF52qgRgoWajQ525EFCSQ7PnuJljFGOM8IRTIhyJGtQhlfyjn3GBsKWECUQkHI11H4NhCoxadKldHmFTsFScRf7O/u/mneFPl113AnE/6bMHpxnkFN1Rv1Ruqr1xBR3aO7qn4HEF36nhKt3br6OLp8rYbTxfPSjfRXKj47y4l6gWA9SFboqqZfor/CNeqJ6o6ME3v8Fzx4oe76LiNkwck27JcwLtLhyuY1aLENk22sHTsWT6sYbqNyoSULTqOfdXgrkCpPBx+sdqqs865iP/yd0WAXP5VQ7HivGro3Xownuzm1R14bIFUfaIWiSu6gzBRcajnKF2rONsZDKo31P0u367wJMaAvro4X7YV3p241sxycK4WHRT3Lp6OjscZfBrPXd6rOqk54dYxcur3mdOLTmzgXBRG6Dxk8oBxBtWHxMKF7nk22FcDKHFY55k9a6Bo7xDCyStjW4kKq90di85qRudzclXbiDXC28Goyu+UMLl+uo2ehcdddLrnXIFRfndwYCJfib/qo+o+yqU72Nx6qAXN6YE7tTxrWu7fTt3jWdWfqj5sKVF1V3Wp9KlaYDo4ZL1F+o9mKPvZCc0lhYPjH/WX0xtZVxlnnLi7uvjBp9scipCoEdEZl7iosdxYq4HtLCl3LjrdgaEaUgmkqoE7eDoN4yxMlZCwBVGRXWHhDItl4/yGHf1l8UN+kP3CId+r+i2eUXHGPsq4Km4gIVZxKqFn8Tj5xhcgR0cQj1jOuV4V1yqRd/uV1T2eZzGxurj6iPhT6SJaTCIGiFcoduSn4ifS4Wjv8oH5YTqvfrJFgz/XvctPB0/3A4CqL4pt1VDpPNN2J99cr8w556W3ir3isP3/6JRO/pObnWXvCiSMoGywMaJcJborWEqAOn4QTnfjfKU2c2YQGASeR0BpgbqvIt49r/y79904XDv3uU/bvS1+9y3gaUA+2/PeVqDPBsTN8QzONwM87geBfwgB9YVhVy92z5+C0o3DtTsV164fVb9d//b5WXRsqMZwEBgEBoFB4CEE2FBXX6zd8D7T0uDG4tq5GDxhd6peW7H+BJpngDoKyzbXAAAAAElFTkSuQmCC';

Dr.Declare('ImageCache', 'class');
Dr.Implement('ImageCache', function (global, module_get) {
	
	var Module = function () {
		this.font_data = {};
	}
	
	Module.prototype._init_font_frame = function (font_data) {
		this.font_offset_rect = [];
		var font_map = font_data.font_map;
		if (font_data.font_offset_rect && font_data.font_offset_rect.length == font_map.length) {
			for (var index = 0; index < font_map.length; index ++) {
				this.font_offset_rect[font_map[index]] = font_data.font_offset_rect[index];
				
			}
		}
		else {
			if (font_data.font_size && font_data.font_size)
		}
		
		
		
		
		var width = this.font_bitmap.width
		var height = this.font_bitmap.height
		
		this.font_canvas = Dr.createOffscreenCanvas(width, height);
		
		for (var i in font_map) {
			var image_data = font_ctx.getImageData(i * font_width, 0, font_width, font_height);
			image.res_font_obj[font_map[i]] = image_data;
			//console.log(i, "get", font_map[i], i * font_width, 0, font_width, font_height)
			
		}
		
	}
	
	Module.prototype._init = function (font_bitmap) {
		var width = this.font_bitmap.width
		var height = this.font_bitmap.height
		
		this.font_canvas = Dr.createOffscreenCanvas(width, height);
		
		for (var i in font_map) {
			var image_data = font_ctx.getImageData(i * font_width, 0, font_width, font_height);
			image.res_font_obj[font_map[i]] = image_data;
			//console.log(i, "get", font_map[i], i * font_width, 0, font_width, font_height)
			
		}
		
	}
	
	Module.prototype.loadFontData = function (font_data) {
		if (
			!font_data.font_src
			|| !font_data.font_map
			|| !(
				(font_data.font_width && font_data.font_height) || font_data.font_size
			)
		) {
			Dr.log("[loadFontData] error font_data", font_data);
			return;
		}
		
		this.font_data = font_data;
		this.font_map = font_data.font_map;
		this.font_map = font_data.font_map;
		
		
		Dr.loadImage(font_data.font_src, function (image_element) {
			Dr.log("[loadFontData] loaded font_src", font_data.font_src);
			this._init(image_element);
		});
	}
	
	
	Module.prototype.step = function () {
	}
	
	return Module;
});













Dr.Declare('BitmapFont', 'class');
Dr.Implement('BitmapFont', function (global, module_get) {
	
	var Module = function () {
		this.font_data = {};
	}
	
	Module.prototype._init_font_frame = function (font_data) {
		this.font_offset_rect = [];
		var font_map = font_data.font_map;
		if (font_data.font_offset_rect && font_data.font_offset_rect.length == font_map.length) {
			for (var index = 0; index < font_map.length; index ++) {
				this.font_offset_rect[font_map[index]] = font_data.font_offset_rect[index];
				
			}
		}
		else {
			if (font_data.font_size && font_data.font_size)
		}
		
		
		
		
		var width = this.font_bitmap.width
		var height = this.font_bitmap.height
		
		
		this.font_canvas = Dr.createOffscreenCanvas(width, height);
		
		
		for (var i in font_map) {
			var image_data = font_ctx.getImageData(i * font_width, 0, font_width, font_height);
			image.res_font_obj[font_map[i]] = image_data;
			//console.log(i, "get", font_map[i], i * font_width, 0, font_width, font_height)
			
		}
		
	}
	
	Module.prototype._init = function (font_bitmap) {
		var width = this.font_bitmap.width
		var height = this.font_bitmap.height
		
		
		this.font_canvas = Dr.createOffscreenCanvas(width, height);
		
		
		for (var i in font_map) {
			var image_data = font_ctx.getImageData(i * font_width, 0, font_width, font_height);
			image.res_font_obj[font_map[i]] = image_data;
			//console.log(i, "get", font_map[i], i * font_width, 0, font_width, font_height)
			
		}
		
	}
	
	Module.prototype.loadFontData = function (font_data) {
		if (
			!font_data.font_src
			|| !font_data.font_map
			|| !(
				(font_data.font_width && font_data.font_height) || font_data.font_size
			)
		) {
			Dr.log("[loadFontData] error font_data", font_data);
			return;
		}
		
		this.font_data = font_data;
		this.font_map = font_data.font_map;
		this.font_map = font_data.font_map;
		
		
		Dr.loadImage(font_data.font_src, function (image_element) {
			Dr.log("[loadFontData] loaded font_src", font_data.font_src);
			this._init(image_element);
		});
	}
	
	
	Module.prototype.step = function () {
	}
	
	return Module;
});